<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsloom Magazine Â· {{ date_str }}</title>
    <style>
        /* ============================================================
         * NEWSLOOM MAGAZINE â€” High-End Fashion/Editorial Magazine
         * ============================================================
         * White base Â· Black primary Â· #FF4500 accent pop
         * Cover story hero Â· Drop cap Â· Multi-column layout
         * Pull quotes Â· Ad placeholders Â· Table of contents
         * Page numbers Â· Running header Â· Section dividers
         * ============================================================ */

        /* --- Design Tokens --- */
        :root {
            /* Backgrounds */
            --bg-primary:     #FFFFFF;
            --bg-secondary:   #F9F9F7;
            --bg-card:        #FAFAF8;
            --bg-surface:     #F2F2EE;
            --bg-hover:       #ECECEA;
            --bg-dark:        #111111;

            /* Text */
            --text-primary:   #111111;
            --text-secondary: #3A3A3A;
            --text-muted:     #777777;
            --text-light:     #AAAAAA;
            --text-inverse:   #FFFFFF;

            /* Accent â€” Vibrant Orange-Red */
            --accent:         #FF4500;
            --accent-light:   #FF6B3D;
            --accent-dark:    #D63B00;
            --accent-dim:     rgba(255, 69, 0, 0.08);
            --accent-glow:    rgba(255, 69, 0, 0.04);

            /* Priority */
            --priority-must:     #FF4500;
            --priority-must-bg:  rgba(255, 69, 0, 0.06);
            --priority-rec:      #D4A017;
            --priority-rec-bg:   rgba(212, 160, 23, 0.06);
            --priority-fyi:      #2D8B55;
            --priority-fyi-bg:   rgba(45, 139, 85, 0.04);

            /* Borders */
            --border:         #E8E8E6;
            --border-strong:  #D0D0CC;
            --border-accent:  var(--accent);

            /* Spacing */
            --sp-1: 4px;  --sp-2: 8px;  --sp-3: 12px;
            --sp-4: 16px; --sp-5: 20px; --sp-6: 24px;
            --sp-8: 32px; --sp-10: 40px; --sp-12: 48px;
            --sp-16: 64px; --sp-20: 80px;

            /* Typography */
            --font-display: "Georgia", "Playfair Display", "Noto Serif SC", "Songti SC", serif;
            --font-sans: "Helvetica Neue", "Arial", "PingFang SC", "Noto Sans SC", "Microsoft YaHei", sans-serif;
            --font-mono: "JetBrains Mono", "SF Mono", "Consolas", monospace;

            /* Radius */
            --radius-sm: 2px;
            --radius-md: 4px;
            --radius-lg: 8px;

            /* Shadows */
            --shadow-card:     0 1px 4px rgba(0, 0, 0, 0.06);
            --shadow-elevated: 0 8px 24px rgba(0, 0, 0, 0.1);
            --shadow-cover:    0 16px 48px rgba(0, 0, 0, 0.15);
        }

        /* --- PDF Page --- */
        @page {
            size: A4;
            margin: 1.2cm 1.5cm;
            @top-left {
                content: "NEWSLOOM MAGAZINE";
                font-family: var(--font-sans);
                font-size: 7pt;
                font-weight: 800;
                color: var(--text-muted);
                letter-spacing: 0.15em;
                text-transform: uppercase;
            }
            @top-right {
                content: "{{ date_str }}";
                font-family: var(--font-sans);
                font-size: 7pt;
                color: var(--text-muted);
            }
            @bottom-center {
                content: counter(page);
                font-family: var(--font-display);
                font-size: 9pt;
                color: var(--text-primary);
            }
        }

        /* --- Reset & Base --- */
        *, *::before, *::after {
            margin: 0; padding: 0; box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            /* Subtle magazine paper texture */
            background:
                radial-gradient(ellipse at 20% 50%, rgba(255, 69, 0, 0.015) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(0, 0, 0, 0.01) 0%, transparent 40%),
                linear-gradient(180deg, #FFFFFF 0%, #FAFAF8 50%, #FFFFFF 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            font-size: 16px;
            line-height: 1.7;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        a {
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.2s;
        }
        a:hover { color: var(--accent); }

        .container {
            max-width: 820px;
            margin: 0 auto;
            padding: var(--sp-10) var(--sp-6);
        }

        /* ============================================================
         * COVER / HEADER â€” Magazine Cover Feel
         * Super-large title + subtitle + cover story pull quote
         * ============================================================ */
        .cover {
            position: relative;
            margin-bottom: var(--sp-12);
            padding: var(--sp-20) var(--sp-10) var(--sp-16);
            overflow: hidden;
        }

        /* Full-bleed dark cover background with gradient */
        .cover-bg {
            position: absolute;
            inset: 0;
            background:
                linear-gradient(160deg, #0D0D0D 0%, #1A1A2E 40%, #16213E 70%, #0F3460 100%);
            border-radius: var(--radius-lg);
            z-index: 0;
        }

        /* Diagonal accent slash */
        .cover-bg::before {
            content: '';
            position: absolute;
            top: -20%;
            right: -5%;
            width: 40%;
            height: 140%;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            transform: rotate(12deg);
            opacity: 0.08;
        }

        /* Bottom accent bar */
        .cover-bg::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--accent), var(--accent-light), transparent);
        }

        .cover-content {
            position: relative;
            z-index: 1;
        }

        /* Magazine masthead */
        .cover-masthead {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--sp-10);
        }

        .cover-brand {
            font-family: var(--font-sans);
            font-size: 0.7em;
            font-weight: 800;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: var(--accent);
        }

        .cover-issue {
            font-family: var(--font-sans);
            font-size: 0.68em;
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        /* Massive cover title */
        .cover-title {
            font-family: var(--font-display);
            font-size: 4em;
            font-weight: 700;
            line-height: 1.0;
            letter-spacing: -0.04em;
            color: var(--text-inverse);
            margin-bottom: var(--sp-5);
        }

        .cover-title-accent {
            color: var(--accent);
            font-style: italic;
        }

        .cover-subtitle {
            font-family: var(--font-display);
            font-size: 1.2em;
            font-weight: 300;
            font-style: italic;
            color: rgba(255, 255, 255, 0.55);
            margin-bottom: var(--sp-10);
            max-width: 70%;
        }

        /* Cover stats */
        .cover-stats {
            display: flex;
            gap: var(--sp-8);
            padding-top: var(--sp-6);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cover-stat-num {
            font-family: var(--font-display);
            font-size: 2em;
            font-weight: 700;
            color: var(--text-inverse);
            line-height: 1;
        }

        .cover-stat-label {
            font-family: var(--font-sans);
            font-size: 0.68em;
            color: rgba(255, 255, 255, 0.45);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: var(--sp-1);
        }

        /* ============================================================
         * TABLE OF CONTENTS â€” Magazine-style TOC
         * ============================================================ */
        .toc {
            margin-bottom: var(--sp-12);
            padding: var(--sp-8) 0;
            border-top: 3px solid var(--text-primary);
            border-bottom: 1px solid var(--border);
        }

        .toc-title {
            font-family: var(--font-sans);
            font-size: 0.72em;
            font-weight: 800;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: var(--sp-5);
        }

        .toc-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--sp-3) var(--sp-8);
        }

        .toc-item {
            display: flex;
            align-items: baseline;
            gap: var(--sp-3);
            padding: var(--sp-2) 0;
            border-bottom: 1px dotted var(--border);
        }

        .toc-num {
            font-family: var(--font-display);
            font-size: 1.4em;
            font-weight: 700;
            color: var(--accent);
            min-width: 32px;
        }

        .toc-label {
            font-family: var(--font-sans);
            font-size: 0.85em;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .toc-count {
            font-family: var(--font-mono);
            font-size: 0.72em;
            color: var(--text-light);
            margin-left: auto;
        }

        /* ============================================================
         * EXECUTIVE SUMMARY â€” Editorial opening with drop cap
         * ============================================================ */
        .exec-summary {
            margin-bottom: var(--sp-12);
            padding: var(--sp-10) var(--sp-8);
            background: var(--bg-primary);
            position: relative;
            page-break-inside: avoid;
        }

        /* Red L-bracket corner accent */
        .exec-summary::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 60px; height: 4px;
            background: var(--accent);
        }

        .exec-summary::after {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 4px; height: 50px;
            background: var(--accent);
        }

        .exec-label {
            font-family: var(--font-sans);
            font-size: 0.68em;
            font-weight: 800;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: var(--sp-6);
        }

        .exec-body {
            column-count: 2;
            column-gap: var(--sp-8);
            column-rule: 1px solid var(--border);
        }

        .exec-body p {
            font-family: var(--font-display);
            font-size: 1.05em;
            line-height: 1.85;
            color: var(--text-secondary);
            margin-bottom: var(--sp-4);
        }

        .exec-body p:last-child { margin-bottom: 0; }
        .exec-body p strong { color: var(--text-primary); font-weight: 600; }

        /* Drop cap */
        .exec-body p:first-of-type::first-letter {
            font-family: var(--font-display);
            font-size: 4.5em;
            float: left;
            line-height: 0.78;
            margin-right: 8px;
            margin-top: 4px;
            font-weight: 700;
            color: var(--accent);
        }

        /* ============================================================
         * SECTION â€” Magazine section headers with bold typography
         * ============================================================ */
        .section {
            margin-bottom: var(--sp-12);
        }

        .section-header {
            display: flex;
            align-items: flex-end;
            gap: var(--sp-4);
            padding-bottom: var(--sp-3);
            margin-bottom: var(--sp-6);
            border-bottom: 3px solid var(--text-primary);
            position: relative;
        }

        /* Section color bar above */
        .section-color-bar {
            position: absolute;
            top: -6px;
            left: 0;
            width: 40px;
            height: 3px;
            border-radius: 2px;
        }

        .section-number {
            font-family: var(--font-display);
            font-size: 2.8em;
            font-weight: 700;
            color: var(--accent);
            line-height: 1;
            letter-spacing: -0.03em;
        }

        .section-info { flex: 1; }

        .section-title {
            font-family: var(--font-display);
            font-size: 1.6em;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        .section-count {
            font-family: var(--font-sans);
            font-size: 0.68em;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* ============================================================
         * BRIEF CARDS â€” Magazine article cards
         * ============================================================ */
        .briefs-grid {
            display: grid;
            gap: var(--sp-5);
        }

        .brief {
            display: flex;
            gap: var(--sp-5);
            background: var(--bg-primary);
            padding: var(--sp-6);
            transition: all 0.2s ease;
            page-break-inside: avoid;
            position: relative;
            border-bottom: 1px solid var(--border);
        }

        .brief:last-child { border-bottom: none; }

        .brief:hover {
            background: var(--bg-secondary);
        }

        /* Priority bar */
        .brief-indicator {
            width: 4px;
            flex-shrink: 0;
            border-radius: 4px;
            align-self: stretch;
        }

        .brief-indicator.must-read {
            background: var(--priority-must);
            box-shadow: 0 0 8px rgba(255, 69, 0, 0.3);
        }
        .brief-indicator.recommended { background: var(--priority-rec); }
        .brief-indicator.fyi { background: var(--priority-fyi); opacity: 0.5; }

        /* Must-read featured styling */
        .brief.is-must-read {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--priority-must-bg) 100%);
            border: 1px solid rgba(255, 69, 0, 0.12);
            border-radius: var(--radius-md);
            padding: var(--sp-8);
        }

        .brief.is-must-read::after {
            content: 'MUST READ';
            position: absolute;
            top: var(--sp-3); right: var(--sp-4);
            font-family: var(--font-sans);
            font-size: 0.55em;
            font-weight: 800;
            letter-spacing: 0.12em;
            color: var(--text-inverse);
            background: var(--accent);
            padding: 3px var(--sp-3);
            border-radius: var(--radius-sm);
        }

        .brief-content { flex: 1; min-width: 0; }

        .brief-headline {
            font-family: var(--font-display);
            font-size: 1.12em;
            font-weight: 700;
            line-height: 1.35;
            margin-bottom: var(--sp-2);
        }

        .brief-headline a {
            color: var(--text-primary);
        }
        .brief-headline a:hover { color: var(--accent); }

        .brief.is-must-read .brief-headline {
            font-size: 1.3em;
        }

        .brief-meta {
            display: flex;
            align-items: center;
            gap: var(--sp-2);
            margin-bottom: var(--sp-3);
            flex-wrap: wrap;
        }

        .source-badge {
            font-family: var(--font-sans);
            font-size: 0.68em;
            font-weight: 700;
            color: var(--text-muted);
            background: var(--bg-surface);
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .tag {
            font-family: var(--font-sans);
            font-size: 0.62em;
            font-weight: 600;
            color: var(--accent);
            background: var(--accent-dim);
            padding: 2px 7px;
            border-radius: var(--radius-sm);
        }

        .brief-detail {
            color: var(--text-secondary);
            font-size: 0.92em;
            line-height: 1.75;
        }

        .brief-detail strong { color: var(--text-primary); font-weight: 600; }

        .brief-detail code {
            font-family: var(--font-mono);
            font-size: 0.88em;
            background: var(--bg-surface);
            padding: 1px 5px;
            border-radius: 3px;
            border: 1px solid var(--border);
        }

        /* ============================================================
         * FEATURED FIRST ARTICLE â€” Hero image simulation
         * ============================================================ */
        .brief.is-featured {
            flex-direction: column;
            padding: 0;
            border: none;
            margin-bottom: var(--sp-6);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .featured-hero {
            width: 100%;
            height: 240px;
            position: relative;
            overflow: hidden;
        }

        .featured-hero-bg {
            position: absolute;
            inset: 0;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .featured-hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 30%, rgba(0, 0, 0, 0.7) 100%);
        }

        .featured-hero-text {
            position: absolute;
            bottom: var(--sp-6);
            left: var(--sp-6);
            right: var(--sp-6);
            z-index: 1;
        }

        .featured-hero-text .brief-headline {
            font-size: 1.8em;
            color: var(--text-inverse);
            margin-bottom: var(--sp-2);
        }

        .featured-hero-text .brief-headline a { color: var(--text-inverse); }

        .brief.is-featured .brief-content {
            padding: var(--sp-6);
        }

        .brief.is-featured .brief-detail {
            font-family: var(--font-display);
            font-size: 1.02em;
            column-count: 2;
            column-gap: var(--sp-8);
            column-rule: 1px solid var(--border);
        }

        /* ============================================================
         * PULL QUOTE â€” Large quotation between articles
         * ============================================================ */
        .pull-quote {
            padding: var(--sp-10) var(--sp-8);
            margin: var(--sp-8) 0;
            text-align: center;
            border-top: 2px solid var(--text-primary);
            border-bottom: 2px solid var(--text-primary);
            position: relative;
        }

        .pull-quote-text {
            font-family: var(--font-display);
            font-size: 1.6em;
            font-weight: 400;
            font-style: italic;
            color: var(--text-primary);
            line-height: 1.4;
            letter-spacing: -0.01em;
        }

        .pull-quote-mark {
            font-size: 3em;
            color: var(--accent);
            line-height: 0.5;
            font-family: var(--font-display);
        }

        /* ============================================================
         * AD PLACEHOLDER â€” Dashed box with "AD" label
         * ============================================================ */
        .ad-placeholder {
            border: 2px dashed var(--border-strong);
            padding: var(--sp-10) var(--sp-6);
            margin: var(--sp-8) 0;
            text-align: center;
            background: var(--bg-secondary);
            position: relative;
        }

        .ad-label {
            font-family: var(--font-sans);
            font-size: 0.65em;
            font-weight: 700;
            color: var(--text-light);
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        .ad-placeholder::before {
            content: 'ADVERTISEMENT';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-family: var(--font-sans);
            font-size: 0.6em;
            font-weight: 700;
            color: var(--text-light);
            letter-spacing: 0.15em;
            background: var(--bg-primary);
            padding: 0 var(--sp-3);
        }

        /* ============================================================
         * SECTION DIVIDER â€” Decorative page break
         * ============================================================ */
        .section-divider {
            display: flex;
            align-items: center;
            gap: var(--sp-4);
            margin: var(--sp-10) 0;
        }

        .section-divider::before,
        .section-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-strong);
        }

        .section-divider-icon {
            font-size: 0.8em;
            color: var(--accent);
        }

        /* ============================================================
         * FOOTER â€” Magazine colophon with running header
         * ============================================================ */
        .footer {
            text-align: center;
            padding: var(--sp-10) 0 var(--sp-6);
            margin-top: var(--sp-16);
            border-top: 4px solid var(--text-primary);
            position: relative;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: var(--accent);
        }

        .footer-brand {
            font-family: var(--font-sans);
            font-size: 0.72em;
            font-weight: 800;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: var(--text-primary);
            margin-bottom: var(--sp-2);
        }

        .footer-tagline {
            font-family: var(--font-display);
            font-size: 0.88em;
            font-style: italic;
            color: var(--text-muted);
            margin-bottom: var(--sp-3);
        }

        .footer-meta {
            font-family: var(--font-sans);
            font-size: 0.68em;
            color: var(--text-light);
            letter-spacing: 0.06em;
        }

        .footer-page {
            margin-top: var(--sp-4);
            font-family: var(--font-display);
            font-size: 1.4em;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* ============================================================
         * Print
         * ============================================================ */
        @media print {
            body {
                background: var(--bg-primary) !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .container { max-width: 100%; padding: 0; }
            .cover { padding: var(--sp-8) var(--sp-6); margin-bottom: var(--sp-8); }
            .cover-bg::before { display: none; }
            .cover-title { font-size: 2.5em; }
            .exec-body { column-count: 1; }
            .brief:hover { background: var(--bg-primary); }
            .brief.is-featured .brief-detail { column-count: 1; }
            .ad-placeholder { display: none; }
            a { color: var(--text-primary) !important; }
        }

        /* ============================================================
         * Mobile
         * ============================================================ */
        @media (max-width: 768px) {
            .container { padding: var(--sp-6) var(--sp-4); }
            .cover { padding: var(--sp-10) var(--sp-5); }
            .cover-title { font-size: 2.4em; }
            .cover-subtitle { max-width: 100%; font-size: 1em; }
            .cover-stats { gap: var(--sp-4); }
            .toc-grid { grid-template-columns: 1fr; }
            .exec-body { column-count: 1; }
            .section-number { font-size: 2em; }
            .brief { padding: var(--sp-4); gap: var(--sp-3); }
            .brief.is-featured .brief-detail { column-count: 1; }
            .featured-hero { height: 160px; }
        }

        @media (max-width: 480px) {
            body { font-size: 15px; }
            .cover-title { font-size: 1.8em; }
            .cover-masthead { flex-direction: column; gap: var(--sp-2); }
            .pull-quote-text { font-size: 1.2em; }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- ====== COVER: Magazine Cover ====== -->
        <header class="cover">
            <div class="cover-bg"></div>
            <div class="cover-content">
                <div class="cover-masthead">
                    <div class="cover-brand">ðŸ“° Newsloom Magazine</div>
                    <div class="cover-issue">Issue {{ date_str|replace('-', '.') }}</div>
                </div>
                <h1 class="cover-title">
                    Daily<br><span class="cover-title-accent">Intelligence</span><br>Brief
                </h1>
                <div class="cover-subtitle">Technology, Markets &amp; Innovation â€” curated by AI for the discerning reader</div>
                <div class="cover-stats">
                    <div>
                        <div class="cover-stat-num">{{ total_items }}</div>
                        <div class="cover-stat-label">Stories</div>
                    </div>
                    {% set must_read_total = [] %}
                    {% for section_key, items in briefs.items() %}
                    {% if items is iterable and items is not string %}
                    {% for item in items %}
                    {% if item.priority == 'ðŸ”´' %}
                    {% if must_read_total.append(1) %}{% endif %}
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% endfor %}
                    <div>
                        <div class="cover-stat-num">{{ must_read_total|length }}</div>
                        <div class="cover-stat-label">Must Read</div>
                    </div>
                    <div>
                        <div class="cover-stat-num">{{ section_order|length }}</div>
                        <div class="cover-stat-label">Sections</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ====== TABLE OF CONTENTS ====== -->
        <nav class="toc">
            <div class="toc-title">Contents</div>
            <div class="toc-grid">
                {% set toc_counter = [1] %}
                {% for section_key in section_order %}
                {% if section_key in briefs and briefs[section_key] is iterable and briefs[section_key] is not string and briefs[section_key]|length > 0 %}
                {% set meta = section_configs.get(section_key, {}) %}
                <div class="toc-item">
                    <span class="toc-num">{{ "%02d"|format(toc_counter[0]) }}</span>
                    <span class="toc-label">{{ meta.emoji|default('ðŸ“Œ') }} {{ meta.title|default(section_key) }}</span>
                    <span class="toc-count">{{ briefs[section_key]|length }}</span>
                </div>
                {% if toc_counter.append(toc_counter.pop() + 1) %}{% endif %}
                {% endif %}
                {% endfor %}
            </div>
        </nav>

        <!-- ====== EXECUTIVE SUMMARY: Editorial Opener ====== -->
        {% if executive_summary %}
        <div class="exec-summary">
            <div class="exec-label">âš¡ Editor's Brief</div>
            <div class="exec-body">
                {% for line in executive_summary.strip().split('\n') %}
                {% if line.strip() %}
                <p>{{ line.strip() | md_inline }}</p>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- ====== SECTIONS: Magazine Editorial Grid ====== -->
        {% set global_section_counter = [1] %}
        {% set show_ad = [0] %}
        {% for section_key in section_order %}
        {% if section_key in briefs and briefs[section_key] is iterable and briefs[section_key] is not string and briefs[section_key]|length > 0 %}
        {% set meta = section_configs.get(section_key, {}) %}
        {% set items = briefs[section_key] %}
        {% set section_color = meta.color|default('#FF4500') %}

        {% if not loop.first %}
        <div class="section-divider"><span class="section-divider-icon">â—†</span></div>
        {% endif %}

        <section class="section">
            <div class="section-header">
                <div class="section-color-bar" style="background: {{ section_color }};"></div>
                <span class="section-number">{{ "%02d"|format(global_section_counter[0]) }}</span>
                <div class="section-info">
                    <h2 class="section-title">{{ meta.title|default(section_key) }}</h2>
                </div>
                <span class="section-count">{{ items|length }} Article{% if items|length != 1 %}s{% endif %}</span>
            </div>

            <div class="briefs-grid">
                {% for item in items %}
                {% set priority = item.priority|default('ðŸŸ¢') %}
                {% set p_class = 'must-read' if priority == 'ðŸ”´' else ('recommended' if priority == 'ðŸŸ¡' else 'fyi') %}
                {% set is_first_must = (loop.first and priority == 'ðŸ”´') %}

                {% if is_first_must %}
                <!-- Featured hero article -->
                <div class="brief is-must-read is-featured">
                    <div class="featured-hero">
                        <div class="featured-hero-bg" style="background: linear-gradient(135deg, {{ section_color }} 0%, {{ section_color }}88 50%, #1a1a2e 100%);"></div>
                        <div class="featured-hero-overlay"></div>
                        <div class="featured-hero-text">
                            <div class="brief-headline">
                                <a href="{{ item.url|default('#') }}" target="_blank">{{ item.headline|default(item.title|default('Untitled')) }}</a>
                            </div>
                        </div>
                    </div>
                    <div class="brief-content">
                        <div class="brief-meta">
                            {% if item.source %}
                            <span class="source-badge">{{ item.source }}</span>
                            {% endif %}
                            {% if item.tags %}
                            {% for tag in item.tags %}
                            <span class="tag">{{ tag }}</span>
                            {% endfor %}
                            {% endif %}
                        </div>
                        {% if item.detail %}
                        <div class="brief-detail">{{ item.detail|default('') | md_inline }}</div>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="brief {{ 'is-must-read' if priority == 'ðŸ”´' }}">
                    <div class="brief-indicator {{ p_class }}"></div>
                    <div class="brief-content">
                        <div class="brief-headline">
                            <a href="{{ item.url|default('#') }}" target="_blank">{{ item.headline|default(item.title|default('Untitled')) }}</a>
                        </div>
                        <div class="brief-meta">
                            {% if item.source %}
                            <span class="source-badge">{{ item.source }}</span>
                            {% endif %}
                            {% if item.tags %}
                            {% for tag in item.tags %}
                            <span class="tag">{{ tag }}</span>
                            {% endfor %}
                            {% endif %}
                        </div>
                        {% if item.detail %}
                        <div class="brief-detail">{{ item.detail|default('') | md_inline }}</div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                {% endfor %}
            </div>

            {# Pull quote after certain sections #}
            {% if loop.index == 2 %}
            <div class="pull-quote">
                <div class="pull-quote-mark">"</div>
                <div class="pull-quote-text">In the age of information abundance, curation is the ultimate luxury.</div>
            </div>
            {% endif %}
        </section>

        {# Ad placeholder every 3 sections #}
        {% if show_ad.append(show_ad.pop() + 1) %}{% endif %}
        {% if show_ad[0] == 3 %}
        <div class="ad-placeholder">
            <div class="ad-label">Your Brand Here Â· Premium Placement</div>
        </div>
        {% if show_ad.pop() is not none %}{% endif %}
        {% if show_ad.append(0) %}{% endif %}
        {% endif %}

        {% if global_section_counter.append(global_section_counter.pop() + 1) %}{% endif %}
        {% endif %}
        {% endfor %}

        <!-- ====== FOOTER: Magazine Colophon ====== -->
        <footer class="footer">
            <div class="footer-brand">Newsloom Magazine</div>
            <div class="footer-tagline">AI-curated intelligence for the discerning mind</div>
            <div class="footer-meta">{{ date_str }} Â· {{ total_items }} sources analyzed Â· {{ generated_time }}</div>
            <div class="footer-page">FIN</div>
        </footer>

    </div>
</body>
</html>